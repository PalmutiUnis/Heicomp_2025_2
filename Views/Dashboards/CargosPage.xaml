<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:MauiApp1.Converters"
             xmlns:microcharts="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             x:Class="MauiApp1.Views.Dashboards.CargosPage"
             Title="Cargos"
             BackgroundColor="{AppThemeBinding Light={StaticResource FundoPaginaClaro}, Dark={StaticResource FundoPaginaEscuro}}"
             Shell.FlyoutBehavior="Flyout">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:CategoriaTotalSumConverter x:Key="CategoriaTotalSumConverter" />
            <conv:CategoriaCorConverter x:Key="CategoriaCorConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- Layout do Shell NavBar -->
    <Shell.TitleView >
        <Grid ColumnDefinitions="Auto, *"
              Style="{StaticResource TitleViewGridStyle}"
              HorizontalOptions="Fill"
              VerticalOptions="Fill"
              Margin="0"
              Padding="0">
            <ImageButton Grid.Column="0"
                         Source="seta_direita.png"  
                         HeightRequest="44"
                         WidthRequest="44"
                         BackgroundColor="Transparent"
                         Clicked="BotaoVoltarPainelGestao"
                         Margin="0"
                         Padding="0"
                         HorizontalOptions="Start"
                         VerticalOptions="Center"/>

            <Label Grid.Column="1"
                   Text="Cargos"
                   Style="{StaticResource TituloShellStyle}"
                   VerticalOptions="Center"
                   HorizontalOptions="Fill"/>

            <ImageButton Grid.Column="2"
                     Source="icone_menu.png"  
                     HeightRequest="44"
                     WidthRequest="44"
                     BackgroundColor="Transparent"
                     Margin="0"
                     Padding="0"
                     HorizontalOptions="End"
                     VerticalOptions="Center"/>
        </Grid>
    </Shell.TitleView>
    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">
            <!-- Card de Distribuição de Cargos -->
            <Frame CornerRadius="12" 
                   Padding="16" 
                   HasShadow="True" 
                   BackgroundColor="{AppThemeBinding Light={StaticResource FundoCardClaro}, Dark={StaticResource FundoCardEscuro}}">
                <VerticalStackLayout>
                    <HorizontalStackLayout>
                        <Label Text="Distribuição de Cargos" 
                               TextColor="{AppThemeBinding Light={StaticResource CorTextoPreto}, Dark={StaticResource CorTextoBranco}}"
                               FontAttributes="Bold" 
                               FontSize="16"/>
                        <Label Text="{Binding TotalColaboradores, StringFormat='Total: {0}'}" 
                               Margin="8,0,0,0"
                               BackgroundColor="{AppThemeBinding Light={StaticResource LabelAzulClaro}, Dark={StaticResource LabelAzulEscuro}}"
                               Padding="6,2"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light={StaticResource TextoAzulClaro}, Dark={StaticResource TextoAzulEscuro}}"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                    <!-- Gráfico (Microcharts) -->
                    
                    <microcharts:ChartView
                        Chart="{Binding PieChart}" 
                        HeightRequest="160" 
                        Margin="0,8,0,8"
                        />
                        
                    <CollectionView ItemsSource="{Binding CategoriaTotais}" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <HorizontalStackLayout Spacing="8" Margin="0,2,0,2">
                                    <BoxView WidthRequest="12" HeightRequest="12" 
                                             Color="{Binding Categoria, Converter={StaticResource CategoriaCorConverter}}"
                                             VerticalOptions="Center"/>
                                    <Label Text="{Binding Categoria}" 
                                           FontSize="14"
                                           TextColor="{AppThemeBinding Light={StaticResource CorTextoPreto}, Dark={StaticResource CorTextoBranco}}"/>
                                    <Label Text="{Binding Total}" FontAttributes="Bold" FontSize="14"/>
                                </HorizontalStackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Card de Cargos Cadastrados -->
            <HorizontalStackLayout>
                <Label 
                    Text="Cargos Cadastrados" 
                    FontAttributes="Bold" 
                    FontSize="16"
                    />
                <Label Text="{Binding CargoCategorias.Count, StringFormat='{0} cargos'}" 
                       FontSize="12" 
                       TextColor="{AppThemeBinding Light={StaticResource CorTextoCinza}, Dark={StaticResource CorTextoCinza}}" Margin="8,0,0,0" VerticalOptions="Center"/>
            </HorizontalStackLayout>
            <CollectionView ItemsSource="{Binding CargoCategorias}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame 
                            CornerRadius="8" 
                            Padding="12" 
                            Margin="0,4,0,4" 
                            HasShadow="False" 
                            BackgroundColor="{AppThemeBinding Light={StaticResource FundoCardClaro}, Dark={StaticResource FundoCardEscuro}}"
                            BorderColor="{AppThemeBinding Light={StaticResource CorCardBorda}, Dark={StaticResource CorCardBordaEscuro}}">
                            <VerticalStackLayout>
                                <Label Text="{Binding Cargo}" FontAttributes="Bold" FontSize="15"/>
                                <HorizontalStackLayout Spacing="6">
                                    <Label Text="{Binding Colaboradores, StringFormat='{0} colaboradores'}"
                                           FontSize="13"
                                           TextColor="{Binding Categoria, Converter={StaticResource CategoriaCorConverter}}"/>
                                    <Label Text="•" 
FontSize="13" 
                                           TextColor="{AppThemeBinding Light={StaticResource CorTextoPreto}, Dark={StaticResource CorTextoBranco}}"/>
                                    <Label Text="{Binding Categoria}" FontSize="13" TextColor="{AppThemeBinding Light={StaticResource CorTextoCinza}, Dark={StaticResource CorTextoCinza}}"/>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>